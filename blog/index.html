<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog - NOCTIPHILUS</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&display=swap" rel="stylesheet">
</head>

<body>
    <header>
        <nav>
            <ul id="menu">
                <li><a href="/" data-translate="home">Inicio</a></li>
                <li><a href="/blog" data-translate="blog">Blog</a></li>
                <li><a href="/multimedia" data-translate="multimedia">Multimedia</a></li>
                <li><a href="/about" data-translate="about">Sobre mí</a></li>
                <li><a href="/contact" data-translate="contact">Contacto</a></li>
                <li class="mobile-only"><a href="#" id="mobile-lang-toggle">EN</a></li>
            </ul>
        </nav>
        <div class="controls">
            <button id="lang-toggle" class="desktop-only" aria-label="Toggle Language">EN</button>
            <button id="theme-toggle" aria-label="Toggle Dark Mode">
                <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5" />
                    <line x1="12" y1="1" x2="12" y2="3" />
                    <line x1="12" y1="21" x2="12" y2="23" />
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                    <line x1="1" y1="12" x2="3" y2="12" />
                    <line x1="21" y1="12" x2="23" y2="12" />
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                </svg>
                <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    style="display:none;">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
            <button id="menu-toggle" aria-label="Toggle Menu" class="mobile-only">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12" />
                    <line x1="3" y1="6" x2="21" y2="6" />
                    <line x1="3" y1="18" x2="21" y2="18" />
                </svg>
            </button>
        </div>
    </header>

    <main>
        <div class="content-container">
            <h1 class="page-title" data-translate="blog_title">Blog</h1>

            <!-- Dynamic Contatiner -->
            <div id="blog-feed">
                <p style="text-align: center; opacity: 0.5;">Cargando artículos...</p>
            </div>
        </div>
    </main>

    <script src="../script.js"></script>
    <script type="module">
        import { getPosts } from '../firebase-logic.js';

        async function loadBlog() {
            const feed = document.getElementById('blog-feed');
            const posts = await getPosts();

            if (posts.length === 0) {
                feed.innerHTML = '<p style="text-align: center; opacity: 0.5;">No hay artículos publicados aún (o falta configuración de Firebase).</p>';
                return;
            }

            feed.innerHTML = ''; // Clear loader

            posts.forEach(post => {
                // Dates formatting
                const d = new Date(post.date);
                const dateStr = d.toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' });

                const article = document.createElement('div');
                article.className = 'article-item';

                // Construct HTML safely
                let imageHTML = '';
                if (post.image && post.image.startsWith('http')) {
                    imageHTML = `<img src="${post.image}" alt="Imagen del post" style="width:100%; max-height: 300px; object-fit: cover; margin-bottom: 1rem; border-radius: 4px; filter: grayscale(100%); transition: filter 0.3s;">`;
                }

                article.innerHTML = `
                    <span class="article-date">${dateStr}</span>
                    <h2 class="article-title">${post.title}</h2>
                    ${imageHTML}
                    <div class="article-content" style="white-space: pre-wrap; opacity: 0.9; line-height: 1.6;">${post.content}</div>
                `;

                // Add hover effect for image grayscale
                if (imageHTML) {
                    const img = article.querySelector('img');
                    article.addEventListener('mouseenter', () => img.style.filter = 'grayscale(0%)');
                    article.addEventListener('mouseleave', () => img.style.filter = 'grayscale(100%)');
                }

                feed.appendChild(article);
            });
        }

        document.addEventListener('DOMContentLoaded', loadBlog);
    </script>
</body>

</html>