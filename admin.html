<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - NOCTIPHILUS</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&display=swap" rel="stylesheet">
    <style>
        /* Admin specific inline overrides for simplicity or add to style.css */
        .admin-login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
    </style>
</head>

<body>
    <!-- Login Overlay -->
    <div id="login-screen" class="admin-login-overlay">
        <h1 class="brand-text" style="font-size: 3rem; margin-bottom: 2rem; animation: none;">NOCTIPHILUS</h1>
        <div class="content-container" style="max-width: 400px; padding: 2rem; border: none; box-shadow: none;">
            <div class="input-group">
                <label>Contraseña de Acceso</label>
                <input type="password" id="admin-pass" placeholder="••••••••">
            </div>
            <button class="submit-btn" id="login-btn" style="width: 100%;">Entrar</button>
            <p id="login-error" style="color: red; display: none; margin-top: 1rem; text-align: center;">Acceso denegado
            </p>
        </div>
    </div>

    <header>
        <nav>
            <ul id="menu">
                <li><a href="index.html">Volver al Sitio</a></li>
            </ul>
        </nav>
        <!-- No controls needed for admin really, maybe theme to check -->
        <div class="controls">
            <button id="theme-toggle" aria-label="Toggle Dark Mode">
                <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5" />
                    <line x1="12" y1="1" x2="12" y2="3" />
                    <line x1="12" y1="21" x2="12" y2="23" />
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                    <line x1="1" y1="12" x2="3" y2="12" />
                    <line x1="21" y1="12" x2="23" y2="12" />
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                </svg>
                <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    style="display:none;">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
        </div>
    </header>

    <main id="admin-panel" style="display: none;">
        <div class="content-container">
            <h1 class="page-title">Nuevo Post</h1>

            <form id="post-form" class="contact-form">
                <div class="input-group">
                    <label>Título del Artículo</label>
                    <input type="text" id="post-title" required placeholder="Ej: La Belleza del Silencio">
                </div>

                <div class="input-group">
                    <label>URL de Imagen Principal</label>
                    <input type="url" id="post-image" placeholder="https://..." required>
                    <span style="font-size: 0.8rem; opacity: 0.7;">Recomendación: Sube la imagen a GitHub primero y
                        copia el link aquí.</span>
                </div>

                <div class="input-group">
                    <label>Contenido</label>
                    <textarea id="post-content" rows="15" required placeholder="Escribe tu artículo aquí..."></textarea>
                </div>

                <div class="input-group">
                    <label>Contraseña de Confirmación</label>
                    <input type="password" id="post-key" required placeholder="Repite la clave">
                </div>

                <button type="submit" class="submit-btn" id="publish-btn">Publicar en Blog</button>
            </form>
            <div id="status-msg" style="margin-top: 1rem; text-align: center;"></div>
        </div>
    </main>

    <!-- Shared Scripts -->
    <script src="script.js"></script>

    <!-- Firebase Logic (Module) -->
    <script type="module">
        import { createPost } from './firebase-logic.js';

        const loginScreen = document.getElementById('login-screen');
        const adminPanel = document.getElementById('admin-panel');
        const loginBtn = document.getElementById('login-btn');
        const adminPassInput = document.getElementById('admin-pass');
        const loginError = document.getElementById('login-error');

        // Simple client-side catch (Not secure for sensitive data, but fine for a blog admin gate)
        // User will set this in the JS or we tell them a default
        const ACCESS_CODE = "noctiphilus2026";

        loginBtn.addEventListener('click', () => {
            if (adminPassInput.value === ACCESS_CODE) {
                loginScreen.style.display = 'none';
                adminPanel.style.display = 'flex';
            } else {
                loginError.style.display = 'block';
            }
        });

        document.getElementById('post-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('publish-btn');
            const status = document.getElementById('status-msg');

            if (document.getElementById('post-key').value !== ACCESS_CODE) {
                status.textContent = "Clave incorrecta.";
                status.style.color = "red";
                return;
            }

            btn.disabled = true;
            btn.textContent = "Publicando...";

            const postData = {
                title: document.getElementById('post-title').value,
                image: document.getElementById('post-image').value,
                content: document.getElementById('post-content').value,
                date: new Date().toISOString()
            };

            try {
                await createPost(postData);
                status.textContent = "¡Publicado correctamente!";
                status.style.color = "green";
                document.getElementById('post-form').reset();
                setTimeout(() => {
                    status.textContent = "";
                    btn.disabled = false;
                    btn.textContent = "Publicar en Blog";
                }, 3000);
            } catch (error) {
                console.error(error);
                status.textContent = "Error al publicar: " + error.message;
                status.style.color = "red";
                btn.disabled = false;
            }
        });
    </script>
</body>

</html>